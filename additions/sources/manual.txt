Возможности устройства без подключения GSM-модуля (SIM-900):
- измерение температур с использованием датчиков температур DS18B20 в диапазоне -99,9...+99,9оС, максимальное количество датчиков - 50
- отображение температур по каждому датчику на двух-строчном жидко-кристаллическом дисплее
- замена/удаление/добавление датчиков температуры посредством меню операций, отображаемом на двухстрочном жидкокристаллическом дисплее, и кнопки управления движением по разделам меню

Дополнительные возможности при подключении GSM-модуля (SIM-900):
- смс-информирование любого пользователя, добавленного в список администратором, о текущих значениях температур по всем датчикам по смс запросу
- смс-информирование любого пользователя, добавленного в список администратором, о выходе за установленные значения температур для тех, кто добавил себя в список информирования
- смс-информирование любого пользователя, добавленного в список администратором, о балансе счёта сим-карты по смс-запросу
- смс-инфомирование администратора о добавленных в систему пользователях, имеющих доступ к получению информации о температурах и балансе, без права изменения настроек
- максимальное количество пользователей, помимо администратора - 2.
- установка администратором через смс-запрос температурных пределов информирования
- активация/деактивация любым зарегистрированнм пользователем через смс-запрос информирования о выходе температур за установленные пределы по каждому датчику
- корректировка через смс-запрос администратором списка добавленных пользователей
- присвоение и изменение администратором через смс-запрос имён датчикам температур для идентификации их расположения(максимальная длина имени 8 символов)
- идентифицкация оператора сотовой сети из перечня Beeline, MTS, Megafon, Tele2 и определение кода запроса баланса (при ошибке идентификации будет отправлен запрос администратору о коде запроса баланса при первом смс-запросе баланса со стороны кого-то из группы зарегистрированных пользователей)
- измеряет мощность принимаемого сигнала сотовой сети, отображает значение количеством вспышек светодиода и информирует пользователей в смс-ответе на запрос значений температур по всем датчикам (T ALL, см. раздел смс-команд)

смс-команды:
1. Переименование устройств, доступ только у администратора.
- текст: REN<пробел><имя><пробел><новое имя> 
---> при успешном выполнении смс-ответ "Rename done"
---> при ошибке в имени датчика в смс-запросе будет отправлен смс-ответ "REN-Incorrect name"

2. Установка верхнего предела температуры, доступ на изменение только у администратора.
- текст: THAL<пробел><имя><пробел><знак><температура> - верхний порог температуры,
---> при успешном выполнении смс-ответ <имя> Tmax <знак><температура>
---> при попытке установить некорректную температуру смс-ответ "Wrong temp.limit"
---> при ошибке в имени датчика в смс-запросе будет отправлен смс-ответ "AL-Incorrect name"

3. Установка нижнего предела температуры, доступ на изменение только у администратора.
- текст TLAL<пробел><имя><пробел><знак><температура>
---> при успешном выполнении смс-ответ <имя датчика >Tmin< знак><температура>
---> при попытке установить некорректную температуру смс-ответ "Wrong temp.limit"
---> при ошибке в имени датчика в смс-запросе будет отправлен смс-ответ "AL-Incorrect name"

4. Активировать/деактивировать отправку смс при понижени ниже нижнего порога, смс-сообщение будет отправлено всем зарегистрированным, кто пришлёт такой смс-запрос
- текст SMS<пробел>TL1(или TL0)<пробел><имя> (TL1 - вкл, TL0 - выкл)
---> при успешном выполнении смс-ответ <имя >SMS_ON (или SMS_OFF)
---> при ошибке в имени датчика в смс-запросе будет отправлен смс-ответ "SMS-Incorrect name"

5. Активировать/деактивировать отправку смс при повышении выше верхнего порога, смс-сообщение будет отправлено всем зарегистрированным, кто пришлёт такой смс-запрос
- текст SMS<пробел>TH1(или TH0)<пробел><имя >(TH1 - вкл, TH0 - выкл)
---> при успешном выполнении смс-ответ <имя >SMS_ON (или SMS_OFF)
---> при ошибке в имени датчика в смс-запросе будет отправлен смс-ответ "SMS-Incorrect name"

6. Запрос температур по всем устройствам, ответ отправляется запросившему, доступ у всех зарегистрированных пользователей
- текст T<пробел>ALL
---> при успешном выполнении смс-ответ в виде списка из строк "<имя ><знак><температура>" ..., последняя строка - "GSM <мощность сигнала>%"
---> при ошибке в тексте команды смс-ответ "Incorrect command"

7. Удаление пользователя из списка зарегистрированных, доступ только у администратора, остальным запросившим отправляется "ACCESS DENIED"
- текст DELETE<пробел><+79xxтелефон>
---> при успешном выполнении смс-ответ в виде списка из строк "<user_ID><телефон>" ..., последняя строка - "BALANS <код запроса баланса>"
---> при ошибке в тексте команды или телефоне смс-ответ "Incorrect command"

8. Замена/регистрация администратора. Доступ только у администратора, или, при отсутствии в списке администратора, любой запросивший может назначить себя таковым. Если администратор зарегистрирован, данная смс-команда будет выполнена только при отправке её с телефона текущего администратора.
- текст ADMIN<пробел><+79ххтелефон>
---> при успешном выполнении смс-ответ ADMIN<пробел><+79ххтелефон> будет отправлен на телефон, с которого был принят запрос; 
---> при ошибке в тексте команды смс-ответ "Incorrect command"

9. Замена/добавление нового пользователя, доступ только у администратора.
- текст USER_(1...2)<пробел><+79ххтелефон>
---> при успешном выполнении смс-ответ в виде списка из строк <user_ID><телефон> ..., в конце строка BALANS <код запроса баланса> 
---> при ошибке в тексте команды смс-ответ "Incorrect command"

10. Получить список зарегистрированных пользователей, доступ только у администратора.
- текст USERS
---> при успешном выполнении смс-ответ  в виде списка из строк <user_ID><телефон> ..., в конце строка BALANS<код запроса баланса> 
---> при ошибке в тексте команды смс-ответ "Incorrect command"

11. Изменение кода USSD-запроса баланса, доступ только у администратора путём отправки этой команды с указанием нового кода
- текст BALANCE<пробел>#xxx#
---> при успешном выполнении в ответ будет отправлена смс с текущим балансом счёта; если смс с балансом не поступила, код запроса баланса был неверен.
---> при ошибке в тексте команды смс-ответ "Incorrect command"

12. Баланс сим-карты, ответ отправляется любому запросившему.
- текст BALANCE
---> при успешном выполнении в ответ будет отправлена смс с текущим балансом счёта
---> при ошибке в тексте команды смс-ответ "Incorrect command"

- Зарегистрированным пользователям, не имеющим права на исполнение какой-либо команды, в ответ будет отправлено смс-сообщение с текстом "ACCESS DENIED"
- Незарегистрированным пользователям ответной смс не отправляется. 
- Ответ на смс-сообщение, не распознанное системой, будет отправлено только если запрос получен от зарегистрированного пользователя. Текст сообщения описан в разделе смс-команд.
- Звонки на номер устройства отклоняютя - занято.
- Все смс-сообщения после обработки удаляются неиедленно.

Сообщения, отправляемые устройством в автоматическом режиме, без запроса пользователей:

Сообщения о выходе температуры за установленные пределы для пользователей, активировавших данное информирование в свой адрес:
- при повышении температуры выше установленного предела "<имя> T> <знак><температура>"
- при понижении температуры ниже установленного предела "<имя> T< <знак><температура>"

Сообщения администратору:
- о неисправности датчика "<имя> FAIL!"
- запрос USSD-кода запроса баланса, если оператор не идентифицирован, отправляется после первого включения, текст - "BALANCE"

Сервисная информация, отображаемая на двух-строчном жидко-кристаллическом дисплее:
- "Ошибка CRC-ID " - ошибка на этапе проверки CRC ID после первичной дешифрации адресов, выводится имя датчика,
- "Ош.CRC-блкн. " - ошибка при проверке CRC данных, прочитанных из блокнота, выводится имя датчика
- "Нет датчиков" -  ошибка на этапе первой инициализации датчиков перед входом в алгоритм дешифрации адресов - если не подключен ни один датчик
- "Нет ответа датч." - ошибка на старте дешифрации адресов после чтения первых двух тайм-слотов - если ответ датчиков не соответствует протоколу 1-Wire
- "Ошибка приёма!" - ошибка приёма байта по Rx
- "TX-буф. полный!" - переполнение кольцевого буфера сообщений в очереди для отправки TX_ring
- "RX-буф. полный!" - переполнение кольцевого буфера принятых сообщений для обработки (RX_ring)

общий алгоритм работы:

1. Рабочий режим:
-> запрос температур с датчиков, их анализ на предмет выхода за установленные границы (отключается при переходе в меню)
-> вывод на экран показаний в цикле по 2 строки (если общее количество нечётное и устройство последнее в списке, выводится одна строка)
---> если датчик на линии активен, выводится имя датчика и температура в формате <знак><целая часть>.<десятичная часть>оС
---> если датчик на линии перестал отвечать, выводится имя датчика и ---.-: при восстановлении работоспособности снова начинает отображаться значение температуры
---> если датчик на линии не ответил контроллеру при стартовом опросе линии, выводится ???.?, более этот датчик контроллером не опрашивается до выключения/включения пиитания
-> однократная отправка смс при выходе значений за установленные границы при условии активации данной задачи для каждого конкретного устойства; гистерезис фиксированный 2гр.С
---> при первом выходе при выходе значений за установленные границы отправляется смс
---> повторно смс отправляется только после возврата в установленные пределы и нового выхода за них, гистерезис 2гр.С

2. Полный сброс устройства - очистка памяти датчиков, поиск и добавление в список всех датчиков, обнаруженных на линии:
-> вход при нажатии кнопки на выключенном устройстве и подаче питания
-> производится полный поиск датчиков 
-> если обнаруженное число датчиков <= 50
---> производится запись найденных датчиков в память с очисткой ранее записанных, имена датчикам присваиваются по умолчанию - Sens.№№№
---> выводится сообщение "Найдено датч.<кол-во>
---> далее переход в рабочий режим
-> если обнаруженное число датчиков > 50
---> выводится сообщение "Много датчиков"
---> остановка программы до перезапуска устройства после корректировки количества подключенных датчиков

3. Нормальный запуск:
-> включение питания без нажатия кнопки
-> выводится сообщение "Опрос линии"
-> если в памяти есть хотя бы один датчик:
---> производится начальный опрос датчиков на линии
---> если в процессе опроса будут обнаружены устройства из списка в памяти, не отвечающие на запросы контроллера, в каждом случае выводится сообщение "Нет ответа <имя датчика>"
---> выводится сообщение о количестве исправных датчиков в памяти "Исправн.датч. <кол-во>» 
---> далее переход в рабочий режим
-> если в памяти нет ни одного датчика - активируется меню добавления датчиков
---> выводится сообщение "Нет датчиков"
---> выводится сообщение "Выполнить поиск?"
---> устройство переходит к ожиданию подтверждения длинным нажатием кнопки (более 1с), короткие нажатия игнорируются
---> после получения подтверждения активируется раздел «Замена/Добавление» меню замены/добавления/удаления датчиков (см.ниже) 
 
Меню замены/добавления/удаления датчиков организовано путём последовательного перемещения по разделам.

Основные разделы меню - "Удалить?" и «Замена/Добавление»
Управление меню:
-> короткое нажатие - отказ от предложенной операции и/или переход к следующему пункту
-> длинное (более 1с) - подтвердить предложенную операцию

Вход в меню:
-> путём однократного длительного (более 2с) нажатия кнопки из рабочего режима 
-> по требованию системы при отсутствии в памяти после включения хотя бы одного датчика 
-> по требованию системы при удалении через меню последнего зарегистрированного датчика 

Выход из меню:
-> при превышении интервала 15с при отсутствии реакции пользователя путём нажатия кнопки
-> при завершении очередной операции с любым результатом выполнения:
---> после удаления какого-либо устройства из памяти
---> после добавления какого-либо устройства в память, в т.ч. путём замены на ранее записанное
---> при неуспешном поиске нового устройства
---> при последовательном отказе от всех операций по списку разделов меню

Работа с меню:
1-> при входе по нажатию кнопки или по требованию системы, выводится сообщение "Корректировка", длительность - 2с
1-> после погасания надписи "Корректировка" выводится стартовый раздел меню:
2---> при отсутствии датчиков в памяти:
3------> выводится сообщение «Замена/Добавл-е»
3------> выводится сообщение "Всего устройств 0» - длительность 2с
3------> выводится сообщение "Подключите устр. и нажмите кнопку"
3------> ожидание 15 с до нажатия кнопки, подтверждающего подключение датчика к линии
4--------> при подключении датчика и подтверждении подключения коротким нажатием:
5------------> при условии обнаружения нового датчика:
6----------------> выводится сообщение "Найдено новое устройство" - длительность 2с
6----------------> при наличии в памяти ячеек с датчиками, от которых не получен ответ при стартовом опросе:
7--------------------> предлагается пункт "<имя датчика> Заменить?"
8------------------------> при согласии предложенный неактивный датчик заменяется новым обнаруженным
8------------------------> при отказе и наличии других неактивных датчиков из списка предлагается следующий неактивный датчик к замене
8------------------------> при отказе от замены последнего предложенного системой датчика и отсутствии других неактивных датчиков в списке:
9----------------------------> предлагается пункт "Добавить?"
10--------------------------------> при согласии и наличии свободной памяти в конце списка:
11------------------------------------> датчик добавляется с именем "Sens.<№ по порядку>"
11------------------------------------> выводится сообщение "Замена выполнена"
11------------------------------------> выход из меню в рабочий режим
10--------------------------------> при согласии и отсутствии свободной памяти в конце списка:
11------------------------------------> выводится сообщение "Память заполнена"
11------------------------------------> выход из меню в рабочий режим
10--------------------------------> при отказе от пункта "Добавить?" - выход из меню в рабочий режим
6----------------> при отсутствии в памяти ячеек с датчиками, от которых не получен ответ при стартовом опросе:
7--------------------> сразу предлагается пункт "Добавить?"
8------------------------> при согласии и наличии свободной памяти в конце списка:
9----------------------------> датчик добавляется с именем device_<№ по порядку>
9----------------------------> выводится сообщение "Выполнено"
9----------------------------> выход из меню в рабочий режим
8------------------------> при согласии и отсутствии свободной памяти в конце списка:
9----------------------------> выводится сообщение "Память заполнена"
9----------------------------> выход из меню в рабочий режим
8------------------------> при отказе от пункта "Добавить?" - выход из меню в рабочий режим
5------------> в случае отсутствии на линии датчика, отличного от записанных в памяти:
6----------------> выводится сообщение "Новых устр-в нет"
6----------------> выход из меню в рабочий режим
4--------> при отсутствии подтверждения нажатием кнопки в течение 15 с - выход из меню в рабочий режим
2---> при наличии датчиков в памяти:
3------> предлагается пункт "УДАЛИТЬ?"
4----------> при согласии:
5--------------> предлагается к удалению первый датчик по списку
6------------------> при согласии:
7----------------------> выводится сообщение "Удалено"
8------------------------> если после удаления очередного датчика в памяти осталось хотя бы один - выход из меню в рабочий режим
8------------------------> если после удаления очередного датчика в памяти не осталось ни одного:
9----------------------------> выводится сообщение «Нет датчиков» - длительность 2с
9----------------------------> выводится сообщение "Корректировка", длительность - 2с
9----------------------------> выводится сообщение «Замена/Добавл-е» - длительность 2с
9----------------------------> далее ход процесса полностью идентичен вышеописанному для случая отсутствия устройств в памяти
4--------------------> при отказе и наличии других датчиков в списке предлагается к удалению следующий датчик по порядку
4--------------------> при отказе и отсутствии других датчиков в списке:
5------------------------> выводится сообщение «Замена/Добавл-е» - длительность 2с
5------------------------> выводится сообщение "Всего устройств <кол-во>» - длительность 2с
5------------------------> выводится сообщение "Подключите устр. и нажмите кнопку"
5------------------------> далее ход процесса полностью идентичен вышеописанному для случая отсутствия датчиков в памяти

Подготовка устройства перед первым включением:
---> вставить сим-карту в телефон и очистить память входящих сообщений (лучше очистить все разделы) и записную книжку
---> отменить запрос пин-кода
---> вставить сим-карту в слот устройства

Первое включение устройства - вариант 1:
- подключить все необходимые датчики к линии (линиям)
- нажать кнопку и, удерживая её, включить устройство, далее кнопку отпустить
- после поиска и обнаружения устройством всех подключенных датчиков проверить соответствие количества подключенных датчиков и обнаруженных устройством
- идентифицировать расположение каждого датчика путём отключения его от линии (при включенном устройстве) и наблюдения за показаниями температуры - для отключенного датчика будет выведено "???".
- переименовать при необходимости датчики через отправку соответствующих смс-команд (см.раздел "смс-команды")

Первое включение устройства - вариант 2:
- подключить один любой датчик к линии
- нажать кнопку и, удерживая её, включить устройство, далее кнопку отпустить
- после поиска и обнаружения устройством подключенного датчика с помощью меню замены/добавления/удаления (см.раздел "Меню замены/добавления/удаления датчиков") добавить остальные датчики
- переименовать при необходимости датчики через отправку соответствующих смс-команд (см.раздел "смс-команды")

Первое включение устройства - вариант 3:
- не подключать ни одного датчика
- нажать кнопку и, удерживая её, включить устройство, далее кнопку отпустить
- устройство выведет сообщение "Нет датчиков", далее - сообщение "Выполнить поиск?"
- подключить один любой датчик, нажать и удержать кнопку более 1с, отпустить кнопку
- устройство перейдёт в раздел «Замена/Добавление» меню замены/добавления/удаления
- дальнейшие действи описаны в описании этого раздела меню 

